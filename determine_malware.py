import os
import json
import statistics
import pandas as pd

# Function to check if a function name is suspicious
def calculate_values(list):
    ## average
    mean = sum(list) / len(list)

    median = statistics.median(list)
    return mean, median

# Define the path to the aggregated_data folder
aggregated_data_dir = 'aggregated_data'

# Iterate through JSON files in the aggregated_data folder
for filename in os.listdir(aggregated_data_dir):
    if filename.endswith('.json'):
        ## file path of data
        file_path = os.path.join(aggregated_data_dir, filename)
        # Read the JSON data from the file
        with open(file_path, 'r') as json_file:
            data = json.load(json_file)

        csv_filename = "sample_list.csv"
        # Load the CSV file using pandas
        df = pd.read_csv(csv_filename)

        # Find the corresponding row based on the given hash value
        matching_row = df[df['Hash'] == data['live']['application']['hash']]

        if matching_row.empty:
            continue

        detections = matching_row['detections'].iloc[0]
        data['VirusTotal'] = {}
        data['VirusTotal']['detections'] = detections
        if detections >= 2:
            data['VirusTotal']['malicious'] = 1
        else:
            data['VirusTotal']['malicious'] = 0

        # Write the updated JSON data back to the file
        with open(file_path, 'w') as json_file:
            json.dump(data, json_file, indent=4)

        print(f'Updated {filename}.')
        

print('Processing complete.')