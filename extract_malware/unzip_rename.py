import pandas as pd
import os, zipfile

### Variables
zip_path = "zips" # path that contains zipped files
extraction_path = "extracted" # path to put extracted and renamed files
csv_path = "VT Links.csv" # path to the CSV file with hash and filenams
zip_pass = "infected" # password for zip file
skip_extraction = False # skip extracting files found in zip_path
skip_rename = False # skip renaming files to their filename



def main():
    ## test if extraction and zip paths exists
    if not os.path.exists(extraction_path):
        os.mkdir(extraction_path)
    if not os.path.exists(zip_path):
        return print(f"Zip path: {zip_path} not found!")
    ## import the csv key to match hashes with filenames
    key = pd.read_csv(csv_path)
    ## extract files in the zip_path directory
    if skip_extraction is not True:
        for zip_file in os.listdir(zip_path):
            with zipfile.ZipFile(f"{zip_path}/{zip_file}") as file:
                file.extractall(extraction_path, pwd=bytes(zip_pass, 'utf-8'))
    ## rename files in the extraction_path directory
    if skip_rename is not True:
        for file in os.listdir(extraction_path):
            file_info = key.loc[key['Hash'] == file]
            if len(file_info) <= 0:
                print(f"{file} not found in key!")
                continue
            file_info = file_info.iloc[0]
            file_name = file_info.Filename
            os.rename(f"{extraction_path}/{file}", f"{extraction_path}/{file_name}")


main()